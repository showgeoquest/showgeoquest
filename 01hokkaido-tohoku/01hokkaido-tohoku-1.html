<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>知識の泉｜北海道・東北</title>

<style>
  :root{
    --sea1:#cfe9ff;       /* 背景：明るい海（ドジャース寄せ） */
    --sea2:#eaf6ff;
    --panel: rgba(255,255,255,.72);
    --border: rgba(120,170,210,.35);

    --landBase:#e7f1e7;   /* 非対象の陸（薄め） */
    --landTarget:#cfe8cf; /* 対象の陸（少し濃い薄緑） */
    --stroke:#5f7f5f;

    --muted:#2b5162;
    --nameBlue:#1e6fff;   /* 県名（青） */
    --capRed:#e23a3a;     /* 県庁所在地（赤） */
  }

  *{ box-sizing: border-box; }

  body{
    margin:0;
    font-family: system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
    background: linear-gradient(180deg,var(--sea1) 0%,var(--sea2) 60%, #fff 100%);
  }

  header{
    padding:12px 14px;
    font-weight: 900;
    letter-spacing:.02em;
    background: var(--panel);
    backdrop-filter: blur(6px);
    border-bottom:1px solid var(--border);
  }

  main{ padding: 12px; }

  .stage{
    position: relative;
    width: 100%;
    height: min(72vh, 620px);
    min-height: 440px;
    border-radius: 18px;
    overflow: hidden;
    border: 1px solid var(--border);
    background: rgba(255,255,255,.35);
    backdrop-filter: blur(6px);
  }

  #svgHost{
    position:absolute;
    inset:0;
  }
  #svgHost svg{
    width:100%;
    height:100%;
    display:block;
  }

  /* ===== SVG 見た目 ===== */
  .geolonia-svg-map .prefecture{
    fill: var(--landBase) !important;
    stroke: var(--stroke) !important;
    stroke-width: 1 !important;
    pointer-events: none;            /* ← まず全部触れない */
    opacity: .40;                    /* ← 非対象は薄く */
  }
  .geolonia-svg-map .prefecture.is-target{
    fill: var(--landTarget) !important;
    opacity: 1;
    pointer-events: auto;            /* ← 対象だけ触れる */
  }
  .geolonia-svg-map .prefecture.is-target:hover{
    filter: brightness(0.98);
    cursor: pointer;
  }

  /* 左上固定パネル（県名＋県庁所在地） */
  .hud{
    position:absolute;
    left: 12px;
    top: 12px;
    z-index: 5;
    background: rgba(255,255,255,.82);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 10px 12px;
    min-width: 210px;
    backdrop-filter: blur(6px);
  }
  .hud .pref{
    font-weight: 1000;
    font-size: 20px;
    color: var(--nameBlue);
    line-height: 1.1;
  }
  .hud .cap{
    margin-top: 6px;
    font-weight: 1000;
    font-size: 18px;
    color: var(--capRed);
    line-height: 1.1;
  }
  .hud .hint{
    margin-top: 6px;
    font-size: 12px;
    color: var(--muted);
    opacity: .85;
  }

  /* タップ位置に「県名ドン（青）」 */
  .tapLabel{
    position:absolute;
    z-index: 6;
    transform: translate(-50%, -120%);
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(255,255,255,.92);
    border: 1px solid var(--border);
    font-size: 18px;
    font-weight: 1000;
    color: var(--nameBlue);
    white-space: nowrap;
    pointer-events: none;
    backdrop-filter: blur(6px);
  }

  /* エラーパネル */
  .errorBox{
    position:absolute;
    inset: 0;
    display:grid;
    place-items:center;
    padding: 18px;
    text-align:center;
    color:#15313e;
  }
  .errorBox .card{
    background: rgba(255,255,255,.85);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 16px 14px;
    max-width: 420px;
  }
  .errorBox b{ display:block; margin-bottom: 8px; }
  .errorBox code{
    background: rgba(0,0,0,.06);
    padding: 2px 6px;
    border-radius: 8px;
  }
</style>
</head>

<body>
<header>知識の泉｜北海道・東北</header>

<main>
  <div class="stage" id="stage">
    <div class="hud" id="hud">
      <div class="pref" id="hudPref">県をタップ</div>
      <div class="cap" id="hudCap">—</div>
      <div class="hint">※ 対象7県だけ反応します</div>
    </div>

    <div id="svgHost"></div>
  </div>
</main>

<script>
  // ===== 設定（ここだけで他地方に使い回せる） =====
  const SVG_PATH = "../maps/japan.svg"; // ★重要：このページは 01hokkaido-tohoku/ 配下なので ../maps/
  const VIEWBOX = "540 -20 520 680";    // 福島の見切れ対策で少し広め（必要なら後で微調整）

  // 対象7県（class名で指定）
  const TARGET_CLASSES = [
    "hokkaido","aomori","iwate","miyagi","akita","yamagata","fukushima"
  ];

  // 県庁所在地（今はこれだけ確実に）
  const CAPITALS = {
    "北海道":"札幌市",
    "青森":"青森市",
    "岩手":"盛岡市",
    "宮城":"仙台市",
    "秋田":"秋田市",
    "山形":"山形市",
    "福島":"福島市",
  };

  function normalizePrefName(titleText){
    const jp = (titleText || "").split("/")[0].trim();
    return jp.replace(/(都|道|府|県)$/g,"");
  }

  function setHud(prefJp){
    const hudPref = document.getElementById("hudPref");
    const hudCap  = document.getElementById("hudCap");

    if(!prefJp){
      hudPref.textContent = "県をタップ";
      hudCap.textContent  = "—";
      return;
    }
    // 表示は「都道府県」を明示（県/道）
    const suffix = (prefJp === "北海道") ? "道" : "県";
    hudPref.textContent = prefJp + suffix;
    hudCap.textContent  = (CAPITALS[prefJp] || "—");
  }

  function showTapLabel(stageEl, x, y, prefJp){
    const old = stageEl.querySelector(".tapLabel");
    if(old) old.remove();

    const label = document.createElement("div");
    label.className = "tapLabel";
    label.textContent = (prefJp === "北海道") ? "北海道" : (prefJp + "県");

    label.style.left = x + "px";
    label.style.top  = y + "px";
    stageEl.appendChild(label);

    // 1.4秒で消える
    setTimeout(()=>{ label.remove(); }, 1400);
  }

  function killAllTitles(svgRoot){
    // ブラウザの hover ツールチップは <title> が原因なので、全部消す
    svgRoot.querySelectorAll("title").forEach(t => t.remove());
    svgRoot.querySelectorAll("desc").forEach(d => d.remove());
  }

  function markTargets(svgRoot){
    // 県ごとの <g class="xxx prefecture"> を対象だけ is-target にする
    const all = svgRoot.querySelectorAll(".prefecture");
    all.forEach(g=>{
      const classList = Array.from(g.classList);
      const hit = TARGET_CLASSES.some(c => classList.includes(c));
      if(hit) g.classList.add("is-target");
    });
  }

  async function loadJapanSvg(){
    const host = document.getElementById("svgHost");
    const stage = document.getElementById("stage");

    try{
      const res = await fetch(SVG_PATH, { cache: "no-cache" });
      if(!res.ok) throw new Error("HTTP " + res.status);

      const text = await res.text();
      host.innerHTML = text;

      const svg = host.querySelector("svg");
      if(!svg) throw new Error("SVG not found");

      // viewBox を北海道・東北に固定
      svg.setAttribute("viewBox", VIEWBOX);
      svg.setAttribute("preserveAspectRatio", "xMidYMid meet");

      // ツールチップ全殺し
      killAllTitles(svg);

      // 対象だけクリック可能に
      markTargets(svg);

      // クリック処理
      const targets = svg.querySelectorAll(".prefecture.is-target");
      targets.forEach(g=>{
        g.addEventListener("click", (ev)=>{
          // class名から県名を推定（titleを消してるので）
          // 県名は TARGET_CLASSES と data-code だけじゃ特定できないので、
          // ここは「元SVGに残ってる情報」を使う：data-code（1..7）
          const code = g.getAttribute("data-code");
          const codeMap = {
            "1":"北海道","2":"青森","3":"岩手","4":"宮城","5":"秋田","6":"山形","7":"福島"
          };
          const prefJp = codeMap[code] || "";

          setHud(prefJp);

          const rect = stage.getBoundingClientRect();
          const x = ev.clientX - rect.left;
          const y = ev.clientY - rect.top;
          showTapLabel(stage, x, y, prefJp);
        }, { passive: true });
      });

      // 初期表示
      setHud("");

    }catch(err){
      host.innerHTML = `
        <div class="errorBox">
          <div class="card">
            <b>地図が読み込めません</b>
            <div>読み込み先：<code>${SVG_PATH}</code></div>
            <div style="margin-top:8px;opacity:.85;">（エラー：${String(err.message || err)}）</div>
          </div>
        </div>
      `;
    }
  }

  // 起動
  loadJapanSvg();
</script>
</body>
</html>