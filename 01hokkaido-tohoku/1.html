<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>知識の泉｜北海道・東北</title>

<link rel="stylesheet" href="../style.css" />

<style>
:root{
  color-scheme: dark;

  --bg:#14356f;

  --panel: rgba(245,252,255,.96);
  --border: rgba(190,235,255,.36);
  --text:#0f1f26;

  --land:#dff0df;
  --landTarget:#cfe8cf;
  --landHover:#bfe2ff;
  --stroke:#6f8f6f;

  --prefBlue:#1466ff;
  --alert:#ff3b3b;
}

*{ box-sizing:border-box; }

html{ background:var(--bg); height:100%; }
body{
  margin:0;
  min-height:100vh;
  font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
}
body::before{
  content:"";
  position:fixed;
  inset:0;
  z-index:-1;
  background:
    radial-gradient(1200px 760px at 50% 6%, rgba(165,230,255,.44), transparent 60%),
    radial-gradient(1100px 700px at 50% 40%, rgba(120,200,255,.28), transparent 62%),
    radial-gradient(1100px 680px at 50% 92%, rgba(120,200,255,.18), transparent 70%),
    linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,0) 28%),
    var(--bg);
}

.topbar{
  width:min(900px,94vw);
  margin:12px auto 0;
}
.back{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border-radius:14px;
  background:linear-gradient(135deg,#5d8cff,#9fd6ff);
  color:white;
  text-decoration:none;
  font-weight:900;
}

.stage{
  position:relative;
  width:min(900px,94vw);
  height:min(74vh,760px);
  min-height:520px;
  margin:12px auto 24px;
  border-radius:20px;
  overflow:hidden;
  background:
    radial-gradient(900px 520px at 50% 18%, rgba(190,245,255,.14), transparent 62%),
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
}

#svgHost, #svgHost svg{
  width:100%;
  height:100%;
}

/* 地図 */
.geolonia-svg-map .prefecture{
  fill:var(--land);
  stroke:var(--stroke);
}
.geolonia-svg-map .prefecture.is-target:hover{
  fill:var(--landHover);
  cursor:pointer;
}
.geolonia-svg-map .prefecture.not-target{
  opacity:.45;
  pointer-events:none;
}

/* ===== 吹き出し ===== */
#tapLabel{
  position:absolute;
  transform:translate(-50%,-120%);
  max-width:8.5em;
  padding:8px 12px;
  border-radius:14px;
  background:var(--panel);
  border:1px solid var(--border);
  text-align:center;
  font-weight:1000;
  font-size:20px;
  line-height:1.15;
  white-space:nowrap;
  display:none;
  box-shadow:0 12px 26px rgba(0,0,0,.18);
}
#tapLabel.alert{
  color:var(--alert);
  font-size:22px;
}

/* 情報パネル */
.infoPanel{
  position:absolute;
  right:14px;
  bottom:84px;
  width:220px;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:18px;
  padding:12px;
}
.pref{
  font-size:18px;
  font-weight:1000;
  color:var(--prefBlue);
  text-align:center;
}
.cap{
  margin-top:6px;
  font-size:16px;
  font-weight:1000;
  text-align:center;
}
.alertText{
  color:var(--alert);
  font-size:18px;
}
</style>
</head>

<body>

<div class="topbar">
  <a class="back" href="./index.html">← 北海道・東北へ戻る</a>
</div>

<div class="stage" id="stage">
  <div id="svgHost"></div>
  <div id="tapLabel"></div>

  <div class="infoPanel">
    <div class="pref" id="prefLine">県をタップ</div>
    <div class="cap" id="capLine">—</div>
  </div>
</div>

<script>
const MAP_PATH = "../maps/japan.svg";
const VIEWBOX = "535 -25 535 700";

const TARGETS = [
  "hokkaido","aomori","iwate","miyagi",
  "akita","yamagata","fukushima"
];

const DATA = {
  "北海道":{ pref:"ほっかいどう", cap:"さっぽろし", capName:"札幌市" },
  "青森県":{ pref:"あおもりけん", cap:"あおもりし", capName:"青森市" },
  "岩手県":{ pref:"いわてけん", cap:"もりおかし", capName:"盛岡市" },
  "宮城県":{ pref:"みやぎけん", cap:"せんだいし", capName:"仙台市" },
  "秋田県":{ pref:"あきたけん", cap:"あきたし", capName:"秋田市" },
  "山形県":{ pref:"やまがたけん", cap:"やまがたし", capName:"山形市" },
  "福島県":{ pref:"ふくしまけん", cap:"ふくしまし", capName:"福島市" }
};

function ruby(base,kana){
  return `<ruby>${base}<rt>${kana}</rt></ruby>`;
}

function core(s){ return s.replace(/(都|道|府|県|市)$/g,""); }

function showLabel(html,x,y,alert=false){
  const l=document.getElementById("tapLabel");
  l.innerHTML=html;
  l.classList.toggle("alert",alert);
  l.style.left=x+"px";
  l.style.top=y+"px";
  l.style.display="block";
  clearTimeout(l._t);
  l._t=setTimeout(()=>l.style.display="none",1200);
}

async function init(){
  const host=document.getElementById("svgHost");
  const svgText=await fetch(MAP_PATH).then(r=>r.text());
  host.innerHTML=svgText;

  const svg=host.querySelector("svg");
  svg.setAttribute("viewBox",VIEWBOX);
  svg.classList.add("geolonia-svg-map");

  const prefs=[...svg.querySelectorAll(".prefecture")];

  prefs.forEach(p=>{
    const ok=TARGETS.some(c=>p.classList.contains(c));
    p.classList.add(ok?"is-target":"not-target");

    if(ok){
      const name=p.querySelector("title")?.textContent.split("/")[0];
      p.dataset.name=name;
      p.addEventListener("pointerdown",e=>{
        const d=DATA[name];
        const alert=core(name)!==core(d.capName);
        showLabel(
          ruby(name,d.pref),
          e.clientX,e.clientY,
          alert
        );
        document.getElementById("prefLine").innerHTML=ruby(name,d.pref);
        document.getElementById("capLine").innerHTML=
          alert
          ? `<span class="alertText">⚡ ${ruby(d.capName,d.cap)} ⚡</span>`
          : ruby(d.capName,d.cap);
      });
    }
  });

  svg.querySelectorAll("title,desc").forEach(n=>n.remove());
}
init();
</script>

</body>
</html>